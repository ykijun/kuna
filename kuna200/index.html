<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ’œ ì¿ ë‚˜ 200ì¼ ğŸ’œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* âœ… ëª¨ë“  ìš”ì†Œê°€ ì»¨í…Œì´ë„ˆë¥¼ ë„˜ì¹˜ì§€ ì•Šë„ë¡ */
    *, *::before, *::after { box-sizing: border-box; }

    :root { --violet:#6d28d9; --bg1:#f5f3ff; --bg2:#ede9fe; --card:#ffffff; }
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#334155
    }
    .wrap{max-width:800px;margin:0 auto;padding:20px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:12px;flex-wrap:wrap}
    h1{margin:0;font-size:24px}

    .card{
      background:var(--card);
      border-radius:16px;
      padding:14px;
      box-shadow:0 8px 30px rgba(0,0,0,.06)
    }
    .stack{display:flex;flex-direction:column;gap:12px}

    input[type="text"]{
      width:100%;
      border:1px solid #e5e7eb;
      border-radius:12px;
      padding:10px;
      outline:none;
      min-width:0;           /* flex ì»¨í…Œì´ë„ˆì—ì„œ ë„˜ì¹¨ ë°©ì§€ */
    }

    .msg-wrap{
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:12px;
      overflow:hidden;
    }
    textarea{
      width:100%;
      min-height:120px;
      border:0;
      outline:none;
      resize:vertical;
      padding:12px;
      font-family:inherit;
      line-height:1.4;
      display:block;
    }

    .actions{
      display:flex;
      justify-content:flex-end; /* ğŸ‘‰ ë°”ê¹¥ ì˜¤ë¥¸ìª½ ì •ë ¬ */
    }
    .btn{
      border:0;
      padding:10px 14px;
      border-radius:12px;
      background:#fff;
      cursor:pointer;
      box-shadow:0 1px 3px rgba(0,0,0,.07)
    }
    .btn.primary{background:var(--violet);color:#fff}
    .btn:disabled{opacity:.5;cursor:not-allowed}

    .meta{font-size:12px;color:#64748b}
    ul{list-style:none;padding:0;margin:14px 0 0;display:flex;flex-direction:column;gap:10px}
    li{display:flex;gap:10px;padding:12px;border-radius:14px;background:#fff;box-shadow:0 1px 8px rgba(0,0,0,.05)}
    .avatar{width:40px;height:40px;border-radius:50%;background:#ddd;display:grid;place-items:center;font-weight:700;color:#475569}
    .grow{flex:1;min-width:0}
    .topline{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .name{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    footer{margin:24px 0 8px;text-align:center;font-size:12px;color:#94a3b8}

    /* ëª¨ë°”ì¼ ê°œì„  */
    @media (max-width: 420px){
      header{justify-content:center;text-align:center}
      h1{font-size:20px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸ’œ ì¿ ë‚˜ 200ì¼ ì¶•í•˜ ë©”ì‹œì§€ ğŸ’œ</h1>
      <div class="meta">ì˜ˆìœ ì‘ì›ì˜ ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!</div>
    </header>

    <div class="card">
      <div class="stack">
        <input id="nick" type="text" maxlength="20" placeholder="ë‹‰ë„¤ì„ (í•„ìˆ˜, ìµœëŒ€ 20ì)" />

        <div class="msg-wrap">
          <textarea id="msg" placeholder="ì‘ì›ì˜ í•œë§ˆë””ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš” (ìµœëŒ€ 500ì). Ctrl/Cmd + Enter ì „ì†¡"></textarea>
        </div>

        <!-- ë²„íŠ¼: ë©”ì‹œì§€ ë°•ìŠ¤ ë°”ê¹¥, ì˜¤ë¥¸ìª½ ì •ë ¬ -->
        <div class="actions">
          <button id="send" class="btn primary" title="Ctrl/Cmd + Enterë¡œ ì „ì†¡">ë‚¨ê¸°ê¸°</button>
        </div>

        <p class="meta">ì˜ˆìœ ë§ë§Œ ë¶€íƒ ë“œë¦½ë‹ˆë‹¤ :)</p>
      </div>
    </div>

    <ul id="list"></ul>
    <div id="bottom"></div>

    <footer>â“’ <span id="year"></span> KUNA 200days message </footer>
  </div>

  <!-- Firebase (v10+) CDN: ëª¨ë“ˆ ë°©ì‹ -->
  <script type="module">
    // â–¼â–¼â–¼ 1) ë³¸ì¸ Firebase ì„¤ì •ìœ¼ë¡œ êµì²´í•˜ì„¸ìš” â–¼â–¼â–¼
    const firebaseConfig = {
    apiKey: "AIzaSyA0ZMbcRDb0837Y-pcWtNu7d2Cs17Zevfs",
    authDomain: "kuna-118cc.firebaseapp.com",
    projectId: "kuna-118cc",
    storageBucket: "kuna-118cc.firebasestorage.app",
    messagingSenderId: "445481439296",
    appId: "1:445481439296:web:7ac885082b280a09168fa5"
    };
    // â–²â–²â–² ì„¤ì • ë â–²â–²â–²

    // Firebase ëª¨ë“ˆ (CDN)
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import {
      getFirestore, collection, addDoc, serverTimestamp,
      onSnapshot, query, orderBy, limit
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // ì´ˆê¸°í™”
    const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // DOM
    const yearEl = document.getElementById("year");
    yearEl.textContent = new Date().getFullYear();
    const nick = document.getElementById("nick");
    const msg = document.getElementById("msg");
    const sendBtn = document.getElementById("send");
    const list = document.getElementById("list");
    const bottom = document.getElementById("bottom");

    // ì§ì „ ë‹‰ë„¤ì„ ê¸°ì–µ
    const SAVED_NICK_KEY = "guestbook_nick";
    const savedNick = localStorage.getItem(SAVED_NICK_KEY);
    if (savedNick) nick.value = savedNick;

    // ì „ì†¡
    async function send() {
      const name = (nick.value || "").trim();
      const text = (msg.value || "").trim();

      if (!name) { alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”."); return; }
      if (name.length > 20) { alert("ë‹‰ë„¤ì„ì€ ìµœëŒ€ 20ìì…ë‹ˆë‹¤."); return; }
      if (!text) { alert("ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”."); return; }
      if (text.length > 500) { alert("ë©”ì‹œì§€ëŠ” ìµœëŒ€ 500ìì…ë‹ˆë‹¤."); return; }

      sendBtn.disabled = true;
      try {
        await addDoc(collection(db, "guestbook"), {
          text: text.slice(0, 500),
          name: name.slice(0, 20),
        });
        localStorage.setItem(SAVED_NICK_KEY, name);
        msg.value = "";
        msg.focus();
        bottom.scrollIntoView({ behavior: "smooth" });
      } catch (e) {
        alert(e.message);
      } finally {
        sendBtn.disabled = false;
      }
    }

    // ë Œë”(ê°„ë‹¨ XSS ë³´í˜¸: textContent ì‚¬ìš©)
    function renderItem(data) {
      const li = document.createElement("li");

      const av = document.createElement("div");
      av.className = "avatar";
      av.textContent = (data.name || "ìµëª…").slice(0, 1);

      const body = document.createElement("div");
      body.className = "grow";

      const top = document.createElement("div");
      top.className = "topline";

      const nameEl = document.createElement("span");
      nameEl.className = "name";
      nameEl.textContent = data.name || "ìµëª…";

      const timeEl = document.createElement("span");
      timeEl.className = "meta";
      const timeEl = document.createElement("span");
      timeEl.className = "meta";
      timeEl.textContent = "ğŸ’œ";

      top.append(nameEl, timeEl);

      const textEl = document.createElement("p");
      textEl.style.whiteSpace = "pre-wrap";
      textEl.style.wordBreak = "break-word";
      textEl.textContent = data.text || "";

      body.append(top, textEl);
      li.append(av, body);
      return li;
    }

    // ì‹¤ì‹œê°„ êµ¬ë…
    const q = query(
      collection(db, "guestbook"),
      orderBy("createdAt", "desc"),
      limit(50)
    );
    onSnapshot(q, (snap) => {
      list.innerHTML = "";
      snap.forEach((d) => list.appendChild(renderItem(d.data())));
    });

    // ì´ë²¤íŠ¸
    sendBtn.addEventListener("click", send);
    msg.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        send();
      }
    });
  </script>
</body>
</html>
